---
// Ours
import { type Dialog } from "../types/main";
import { md } from "../lib/markdown";
import * as style from "../styles/dialog.styles";

// Types
interface Props extends Dialog {}

// Props
const { heading, content } = Astro.props;

// Local
const copy = await md.inline(content ?? "");
---


<script>
const storageKey = "__cplpc_visited__";
const storageValue = "true";
const $dialog = document.querySelector<HTMLDialogElement>("#message");

window.addEventListener("DOMContentLoaded", function visited() {
  const token = window.sessionStorage.getItem(storageKey);

  if (token !== storageValue) {
    window.requestAnimationFrame(() => void $dialog?.showModal());
    window.sessionStorage.setItem(storageKey, storageValue);
  };

  window.removeEventListener("DOMContentLoaded", visited);
});
</script>


<dialog
  id="message"
  class={style.root}
  aria-label={heading || undefined}
>

  {content && <p set:html={copy} />}

  <form method="dialog">
    <button
      class={style.button}
      autofocus
    >
      OK
    </button>
  </form>
</dialog>
